# Copyright (c) 2025-2026, Mekion
# SPDX-License-Identifier: Apache-2.0
"""Pre-Programmed routines for the Bimo Robotics Kit"""

from time import sleep, time


class BimoRoutines():
    def __init__(self):
        self.base_routines = {
            "sit": self.sit_routine(),
            "stand": self.stand_routine(),
        }

        self.new_routines = {}

    def perform(self, bimo, rt_name):
        """Performs hardcoded routine"""
        step = 0
        period = 0.05
        routine = self.get_routine(rt_name)

        t1 = time()
        while step < len(routine):
            bimo.send_positions(routine[step])
            step += 1

            t1 += period
            sleep_dt = max(0, t1 - time())
            sleep(sleep_dt)

    def add_routine(self, name, routine):
        """Register custom routine"""
        if (name not in list(self.base_routines.keys())
                and name not in list(self.new_routines.keys())):

            self.new_routines[name] = routine

        else:
            raise RuntimeError(f"ERROR: Routine '{name}' is already registered!")

    def get_routine(self, name):
        """Get routine by name"""
        if self.base_routines[name]:
            return self.base_routines[name]

        elif self.new_routines[name]:
            return self.new_routines[name]

        else:
            raise RuntimeError(f"ERROR: Routine '{name}' not registered!")

    def sit_routine(self):
        poses = [
            [-30, -30, 0, 0, 60, 60, 30, 30],  # Settles standing
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 62, 62, 30.95, 30.95],  # Sits
            [-30, -30, 0, 0, 64, 64, 31.9, 31.9],
            [-30, -30, 0, 0, 66, 66, 32.85, 32.85],
            [-30, -30, 0, 0, 68, 68, 33.8, 33.8],
            [-30, -30, 0, 0, 70, 70, 34.75, 34.75],
            [-30, -30, 0, 0, 72, 72, 35.7, 35.7],
            [-30, -30, 0, 0, 74, 74, 36.65, 36.65],
            [-30, -30, 0, 0, 76, 76, 37.6, 37.6],
            [-30, -30, 0, 0, 78, 78, 38.55, 38.55],
            [-30, -30, 0, 0, 80, 80, 39.5, 39.5],
            [-30, -30, 0, 0, 82, 82, 40.45, 40.45],
            [-30, -30, 0, 0, 84, 84, 41.4, 41.4],
            [-30, -30, 0, 0, 86, 86, 42.35, 42.35],
            [-30, -30, 0, 0, 88, 88, 43.3, 43.3],
            [-30, -30, 0, 0, 90, 90, 44.25, 44.25],
            [-30, -30, 0, 0, 92, 92, 45.2, 45.2],
            [-30, -30, 0, 0, 94, 94, 46.15, 46.15],
            [-30, -30, 0, 0, 96, 96, 47.1, 47.1],
            [-30, -30, 0, 0, 98, 98, 48.05, 48.05],
            [-30, -30, 0, 0, 100, 100, 49.0, 49.0],
            [-30, -30, 0, 0, 102, 102, 49.95, 49.95],
            [-30, -30, 0, 0, 104, 104, 50.9, 50.9],
            [-30, -30, 0, 0, 106, 106, 51.85, 51.85],
            [-30, -30, 0, 0, 108, 108, 52.8, 52.8],
            [-30, -30, 0, 0, 110, 110, 53.75, 53.75],
            [-30, -30, 0, 0, 112, 112, 54.7, 54.7],
            [-30, -30, 0, 0, 114, 114, 55.65, 55.65],
            [-30, -30, 0, 0, 116, 116, 56.6, 56.6],
            [-30, -30, 0, 0, 118, 118, 57.55, 57.55],
            [-30, -30, 0, 0, 120, 120, 58.5, 58.5],
            [-30, -30, 0, 0, 122, 122, 59.45, 59.45],
            [-30, -30, 0, 0, 124, 124, 60.4, 60.4],
            [-30, -30, 0, 0, 126, 126, 61.35, 61.35],
            [-30, -30, 0, 0, 128, 128, 62.3, 62.3],
            [-30, -30, 0, 0, 130, 130, 63.25, 63.25],
            [-30, -30, 0, 0, 132, 132, 64.2, 64.2],
            [-30, -30, 0, 0, 134, 134, 65.15, 65.15],
            [-30, -30, 0, 0, 136, 136, 66.1, 66.1],
            [-30, -30, 0, 0, 138, 138, 67.05, 67.05],
            [-30, -30, 0, 0, 140, 140, 68, 68],  # Settles
            [-25, -25, 0, 0, 140, 140, 68, 68],
            [-20, -20, 0, 0, 140, 140, 68, 68],
            [-15, -15, 0, 0, 140, 140, 68, 68],
            [-10, -10, 0, 0, 140, 140, 70, 70],
            [-5, -5, 0, 0, 140, 140, 72, 72],
            [0, 0, 0, 0, 140, 140, 74, 74],
            [0, 0, 0, 0, 140, 140, 76, 76],
            [0, 0, 0, 0, 140, 140, 78, 78],
            [0, 0, 0, 0, 140, 140, 80, 80],
            [0, 0, 0, 0, 140, 140, 82, 82],
            [0, 0, 0, 0, 140, 140, 84, 84],
            [0, 0, 0, 0, 140, 140, 86, 86],
            [0, 0, 0, 0, 140, 140, 88, 88],
            [0, 0, 0, 0, 140, 140, 89, 89],
            [0, 0, 0, 0, 140, 140, 90, 90],
            [0, 0, 0, 0, 140, 140, 91, 91],
            [0, 0, 0, 0, 140, 140, 91, 91],
            [0, 0, 0, 0, 140, 140, 92, 92],
            [-45, -45, 0, 0, 140, 140, 93, 93],
        ]
        return poses

    def stand_routine(self):
        poses = [
            [-45, -45, 0, 0, 140, 140, 93, 93],  # Preapres stand
            [-45, -45, 0, 0, 140, 140, 93, 93],
            [-40, -40, 0, 0, 140, 140, 93, 93],
            [-35, -35, 0, 0, 140, 140, 93, 93],
            [-30, -30, 0, 0, 140, 140, 93, 93],
            [-25, -25, 0, 0, 140, 140, 93, 93],
            [-20, -20, 0, 0, 140, 140, 93, 93],
            [-18, -18, 0, 0, 140, 140, 93, 93],
            [-16, -16, 0, 0, 140, 140, 93, 93],
            [-15, -15, 0, 0, 140, 140, 93, 93],
            [-12, -12, 0, 0, 145, 140, 93, 93],
            [-10, -10, 0, 0, 140, 140, 93, 93],
            [-8, -8, 0, 0, 140, 140, 93, 93],
            [-4, -4, 0, 0, 139, 139, 93, 93],
            [-2, -2, 0, 0, 139, 139, 93, 93],
            [0, 0, 0, 0, 139, 139, 92, 92],
            [2, 2, 0, 0, 139, 139, 91, 91],
            [4, 4, 0, 0, 139, 138, 90, 90],
            [6, 6, 0, 0, 139, 139, 89, 89],
            [6, 6, 0, 0, 139, 139, 88, 88],
            [6, 6, 0, 0, 139, 139, 86, 86],
            [6, 6, 0, 0, 139, 139, 84, 84],
            [6, 6, 0, 0, 139, 139, 82, 82],
            [6, 6, 0, 0, 139, 139, 80, 80],
            [6, 6, 0, 0, 139, 139, 78, 78],
            [4, 4, 0, 0, 139, 139, 76, 76],  # Stands up
            [2, 2, 0, 0, 139, 139, 74, 74],
            [0, 0, 0, 0, 139, 139, 72, 72],
            [-2, -2, 0, 0, 139, 139, 72, 72],
            [-4, -2, 0, 0, 139, 139, 70, 70],
            [-8, -8, 0, 0, 139, 139, 68, 68],
            [-12, -12, 0, 0, 139, 139, 66, 66],
            [-15, -15, 0, 0, 139, 139, 64, 64],
            [-20, -20, 0, 0, 139, 139, 64, 64],
            [-25, -25, 0, 0, 139, 139, 64, 64],
            [-30, -30, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-45, -45, 0, 0, 139, 139, 64, 64],
            [-44, -44, 0, 0, 134, 134, 64, 64],
            [-43, -43, 0, 0, 129, 129, 62, 62],
            [-42, -42, 0, 0, 124, 124, 60, 60],
            [-41, -41, 0, 0, 119, 119, 58, 58],
            [-40, -40, 0, 0, 114, 114, 56, 56],
            [-39, -39, 0, 0, 109, 109, 54, 54],
            [-38, -38, 0, 0, 104, 104, 52, 52],
            [-37, -37, 0, 0, 99, 99, 50, 50],
            [-36, -36, 0, 0, 94, 94, 48, 48],
            [-35, -35, 0, 0, 89, 89, 46, 46],
            [-34, -34, 0, 0, 84, 84, 44, 44],
            [-33, -33, 0, 0, 79, 79, 42, 42],
            [-32, -32, 0, 0, 74, 74, 40, 40],
            [-31, -31, 0, 0, 69, 69, 38, 38],
            [-30, -30, 0, 0, 66, 66, 36, 36],
            [-30, -30, 0, 0, 64, 64, 34, 34],
            [-30, -30, 0, 0, 62, 62, 32, 32],
            [-30, -30, 0, 0, 60, 60, 30, 30],  # Settles standing
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
            [-30, -30, 0, 0, 60, 60, 30, 30],
        ]
        return poses
